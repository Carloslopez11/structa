<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Structa Quotes - Premium Invoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
:root{ --purple:#7c3aed; --dark:#0f0f16; }

body{
  margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background:radial-gradient(circle at top,#1a1a2e,#0b0b0f);
  color:white; padding:20px;
}

.container{
  max-width:800px; margin:auto; background:var(--dark);
  padding:30px; border-radius:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

h1 span{ color:var(--purple); }

input{
  width:100%; box-sizing: border-box; padding:12px; margin-bottom:10px;
  background:#1e1e2d; border:1px solid #333; color:white; border-radius:8px;
  outline: none; transition: 0.3s;
}
input:focus { border-color: var(--purple); }

button.btn-generate {
  width:100%; padding:14px; background:linear-gradient(135deg,#7c3aed,#5b21b6);
  border:none; color:white; font-weight:bold; border-radius:10px; cursor:pointer;
  font-size: 16px; margin-top: 10px;
}

/* Estilos del Preview HTML */
#invoice{
  display:none; background:white; color:black; padding:40px;
  border-radius:14px; margin-top:30px; animation: fadeIn 0.5s;
}

.header{ display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid var(--purple); padding-bottom:15px; }
.header img{ height:70px; object-fit: contain; }
.header h2{ color:var(--purple); margin:0; }

.info{ margin-top:20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.table{ width:100%; border-collapse:collapse; margin-top:20px; }
.table th{ background:var(--purple); color:white; padding:10px; text-align: left;}
.table td{ border-bottom:1px solid #ddd; padding:10px; }
.total-box{ margin-top:20px; text-align:right; font-size:24px; font-weight:bold; color:var(--purple); }

.actions { display: flex; gap: 10px; margin-top: 30px; }
.btn-action {
  flex: 1; padding: 12px; text-align: center; border-radius: 8px; 
  font-weight: bold; text-decoration: none; cursor: pointer; border: none;
}
.btn-pdf { background: #333; color: white; }
.btn-pay { background: #22c55e; color: black; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>

<body>

<div class="container">
  <h1>Create <span>Premium</span> Professional Quotes</h1>

  <label style="font-size:12px; color:#aaa;">Upload Logo (Optional)</label>
  <input type="file" id="logoUpload" accept="image/*">
  
  <input id="company" placeholder="Your Company Name (Issuer)">
  <input id="client" placeholder="Client Name">
  <input id="work" placeholder="Project Description (e.g. Flooring)">
  
  <div style="display:flex; gap:10px;">
    <input id="length" type="number" placeholder="Length (m)">
    <input id="width" type="number" placeholder="Width (m)">
  </div>
  <input id="price" type="number" placeholder="Price per m² (USD)">

  <button class="btn-generate" onclick="generatePreview()">Preview Quote</button>

  <div id="invoice">
    <div class="header">
      <img id="logoPreview" style="display:none;"> <div style="text-align: right; width: 100%;">
        <h2>ESTIMATE</h2>
        <p style="color:#666; margin:5px 0;">Date: <span id="date"></span></p>
      </div>
    </div>

    <div class="info">
      <div>
        <p style="color:#888; font-size:12px; margin-bottom:5px;">FROM</p>
        <p><strong><span id="i-company"></span></strong></p>
      </div>
      <div>
        <p style="color:#888; font-size:12px; margin-bottom:5px;">TO</p>
        <p><strong><span id="i-client"></span></strong></p>
      </div>
    </div>

    <table class="table">
      <tr><th>Description</th><th>Area</th><th>Price Unit</th><th>Total</th></tr>
      <tr>
        <td id="t-work"></td>
        <td id="t-area"></td>
        <td id="t-price"></td>
        <td id="t-total"></td>
      </tr>
    </table>

    <div class="total-box">Total: $<span id="final"></span></div>

    <div class="actions">
      <button class="btn-action btn-pdf" onclick="downloadPDF()">Download PDF</button>
      <a href="https://buy.stripe.com/test_00w7sL6il3jwbK81D01ck01" target="_blank" class="btn-action btn-pay">
        Pay Now (Stripe)
      </a>
    </div>
  </div>

  <footer style="text-align:center;color:#aaa;margin-top:40px; font-size:12px;">
    © 2025 Structa — Premium Business Tools
  </footer>
</div>

<script>
// Variables Globales
let logoData = null; // null por defecto
const { jsPDF } = window.jspdf; // Acceso a la librería

// Manejo del Logo
document.getElementById("logoUpload").addEventListener("change", e => {
  if (e.target.files && e.target.files[0]) {
    const reader = new FileReader();
    reader.onload = () => {
      logoData = reader.result;
      document.getElementById('logoPreview').src = logoData;
      document.getElementById('logoPreview').style.display = 'block';
    };
    reader.readAsDataURL(e.target.files[0]);
  }
});

// 1. Función para mostrar el Preview en HTML (Tu lógica original mejorada)
function generatePreview(){
  const l = parseFloat(document.getElementById('length').value);
  const w = parseFloat(document.getElementById('width').value);
  const p = parseFloat(document.getElementById('price').value);

  if(!l || !w || !p){ alert("Please complete all numeric fields"); return; }

  const area = l * w;
  const total = area * p;

  // Llenar HTML
  document.getElementById('i-company').textContent = document.getElementById('company').value || "My Company";
  document.getElementById('i-client').textContent = document.getElementById('client').value || "Client Name";
  document.getElementById('date').textContent = new Date().toLocaleDateString();

  document.getElementById('t-work').textContent = document.getElementById('work').value || "Service";
  document.getElementById('t-area').textContent = area.toFixed(2) + " m²";
  document.getElementById('t-price').textContent = "$" + p.toFixed(2);
  document.getElementById('t-total').textContent = "$" + total.toFixed(2);
  document.getElementById('final').textContent = total.toFixed(2);

  document.getElementById('invoice').style.display = "block";
}

// 2. Función "Mágica" para generar el PDF Profesional
function downloadPDF() {
  const doc = new jsPDF();
  
  // Colores y Fuentes
  const purple = [124, 58, 237]; // Tu color #7c3aed
  const dark = [20, 20, 30];

  // Datos
  const company = document.getElementById('company').value || "Company Name";
  const client = document.getElementById('client').value || "Client Name";
  const work = document.getElementById('work').value || "Service";
  const l = parseFloat(document.getElementById('length').value);
  const w = parseFloat(document.getElementById('width').value);
  const p = parseFloat(document.getElementById('price').value);
  const area = (l * w).toFixed(2);
  const total = (l * w * p).toFixed(2);

  // --- DISEÑO DEL PDF ---
  
  // Franja Colorida
  doc.setFillColor(...purple);
  doc.rect(0, 0, 210, 15, 'F');

  // Logo (si existe)
  if (logoData) {
    try {
        doc.addImage(logoData, 'JPEG', 15, 25, 30, 30); // x, y, w, h
    } catch (e) {
        console.warn("Logo format not supported directly, skipping");
    }
  }

  // Encabezado
  doc.setFont("helvetica", "bold");
  doc.setFontSize(20);
  doc.setTextColor(...purple);
  doc.text("ESTIMATE", 150, 35);
  
  doc.setFontSize(10);
  doc.setTextColor(100);
  doc.text(`Date: ${new Date().toLocaleDateString()}`, 150, 42);
  doc.text(`ID: #ST-${Math.floor(Math.random()*1000)}`, 150, 47);

  // Info Cliente / Empresa
  doc.setTextColor(0);
  doc.setFontSize(10);
  
  // Columna Izq
  doc.setFont("helvetica", "bold");
  doc.text("FROM:", 15, 70);
  doc.setFont("helvetica", "normal");
  doc.text(company, 15, 76);

  // Columna Der
  doc.setFont("helvetica", "bold");
  doc.text("TO:", 120, 70);
  doc.setFont("helvetica", "normal");
  doc.text(client, 120, 76);

  // Tabla usando AutoTable
  doc.autoTable({
    startY: 90,
    head: [['Description', 'Dimensions', 'Area', 'Price/m²', 'Total']],
    body: [
      [work, `${l}m x ${w}m`, `${area} m²`, `$${p}`, `$${total}`]
    ],
    headStyles: { fillColor: purple },
    styles: { fontSize: 11, cellPadding: 5 },
    theme: 'grid'
  });

  // Total Final
  const finalY = doc.lastAutoTable.finalY + 15;
  doc.setFontSize(14);
  doc.setFont("helvetica", "bold");
  doc.setTextColor(...purple);
  doc.text(`Total: $${total}`, 195, finalY, { align: 'right' });

  // Footer
  doc.setFontSize(8);
  doc.setTextColor(150);
  doc.text("Generated by Structa - Premium Tools", 105, 290, { align: "center" });

  // Descargar
  doc.save(`Quote_${client}.pdf`);
}
</script>

</body>
</html>
